<?xml version="1.0" encoding="UTF-8" ?>
<project name="PTDB Logical Design v5" database="Db2" id="fc633c19-5aca-4b9b-b90a-c37c5245b90c" >
	<schema name="DB2INST1" >
		<table name="COURSEOFFERING" prior="courseOffering" >
			<column name="OFFERINGID" prior="offeringId" type="INTEGER" jt="4" mandatory="y" >
				<identity><![CDATA[QAUTO_INCREMENTE]]></identity>
			</column>
			<column name="SBJNO" prior="sbjNo" type="VARCHAR" length="25" jt="12" mandatory="y" />
			<column name="LECNO" prior="lecNo" type="INTEGER" jt="4" mandatory="y" />
			<column name="TERM" prior="term" type="VARCHAR" length="20" jt="12" mandatory="y" />
			<column name="CNTLEC" prior="cntLec" type="DECIMAL" jt="3" mandatory="y" />
			<column name="CNTCURR" prior="cntCurr" type="INTEGER" jt="4" mandatory="y" />
			<column name="CNTSCHD" prior="cntSchd" type="INTEGER" jt="4" mandatory="y" />
			<column name="ASSNOTES" prior="assNotes" type="VARCHAR" length="150" jt="12" />
			<index name="PK_COURSEOFFERING" unique="PRIMARY_KEY" >
				<column name="OFFERINGID" />
				<column name="SBJNO" />
				<column name="LECNO" />
				<column name="TERM" />
			</index>
			<fk name="FK_COURSEOFFERING_SUBJECT" to_schema="DB2INST1" to_table="SUBJECT" >
				<fk_column name="SBJNO" pk="SBJNO" />
			</fk>
			<fk name="FK_COURSEOFFERING_LECTURER" to_schema="DB2INST1" to_table="LECTURER" >
				<fk_column name="LECNO" pk="LECNO" />
			</fk>
			<fk name="FK_COURSEOFFERING_SEMESTER" to_schema="DB2INST1" to_table="SEMESTER" >
				<fk_column name="TERM" pk="TERM" />
			</fk>
		</table>
		<table name="LECTURER" prior="lecturer" >
			<column name="LECNO" prior="lecNo" type="INTEGER" jt="4" mandatory="y" />
			<column name="LECNAME" prior="lecName" type="VARCHAR" length="100" jt="12" mandatory="y" />
			<column name="LEC1STN" prior="lec1stn" type="VARCHAR" length="100" jt="12" />
			<column name="LECROOM" prior="lecRoom" type="VARCHAR" length="20" jt="12" />
			<column name="LECNOTES" prior="lecNotes" type="VARCHAR" length="150" jt="12" />
			<column name="ISPROF" prior="isProf" type="BOOLEAN" jt="16" mandatory="y" />
			<column name="LECDEPT" prior="lecDept" type="VARCHAR" length="5" jt="12" mandatory="y" />
			<column name="SUPERVISOR" prior="supervisor" type="VARCHAR" length="100" jt="12" />
			<index name="PK_LECTURER" unique="PRIMARY_KEY" >
				<column name="LECNO" />
			</index>
		</table>
		<table name="SEMESTER" prior="semester" >
			<column name="TERM" prior="term" type="VARCHAR" length="20" jt="12" mandatory="y" />
			<index name="PK_SEMESTER" unique="PRIMARY_KEY" >
				<column name="TERM" />
			</index>
		</table>
		<table name="SUBJECT" prior="subject" >
			<column name="SBJNO" prior="sbjNo" type="VARCHAR" length="25" jt="12" mandatory="y" />
			<column name="SBJLEVEL" prior="sbjLevel" type="INTEGER" jt="4" mandatory="y" />
			<column name="STUDYPRG" prior="studyPrg" type="CHAR" length="10" jt="1" mandatory="y" />
			<column name="SBJNAME" prior="sbjName" type="VARCHAR" length="100" jt="12" mandatory="y" />
			<column name="ELECTIVE" prior="elective" type="CHAR" length="10" jt="1" mandatory="y" />
			<column name="NUMCURR" prior="numCurr" type="INTEGER" jt="4" mandatory="y" />
			<column name="NUMSCHD" prior="numSchd" type="INTEGER" jt="4" mandatory="y" />
			<column name="SRVCLIENT" prior="srvClient" type="VARCHAR" length="10" jt="12" mandatory="y" />
			<column name="SBJNOTES" prior="sbjNotes" type="VARCHAR" length="150" jt="12" />
			<index name="PK_SUBJECT" unique="PRIMARY_KEY" >
				<column name="SBJNO" />
			</index>
		</table>
		<table name="WORKLOADREDUCTION" prior="WorkLoadReduction" >
			<column name="REDUCTIONID" prior="reductionId" type="INTEGER" jt="4" mandatory="y" >
				<identity><![CDATA[QAUTO_INCREMENTE]]></identity>
			</column>
			<column name="TERM" prior="term" type="VARCHAR" length="20" jt="12" mandatory="y" />
			<column name="LECNO" prior="lecNo" type="INTEGER" jt="4" mandatory="y" />
			<column name="JOBTITLE" prior="jobTitle" type="VARCHAR" length="100" jt="12" mandatory="y" />
			<column name="REDUCTION" prior="reduction" type="INTEGER" jt="4" mandatory="y" />
			<index name="PK_WORKLOADREDUCTION" unique="PRIMARY_KEY" >
				<column name="REDUCTIONID" />
			</index>
			<index name="UNQ_LEC_NO" unique="UNIQUE_INDEX" >
				<column name="LECNO" />
			</index>
			<index name="UNQ_TERM" unique="UNIQUE_INDEX" >
				<column name="TERM" />
			</index>
			<fk name="FK_WORKLOADREDUCTION_LECTURER" to_schema="DB2INST1" to_table="LECTURER" >
				<fk_column name="LECNO" pk="LECNO" />
			</fk>
			<fk name="FK_WORKLOADREDUCTION_SEMESTER" to_schema="DB2INST1" to_table="SEMESTER" >
				<fk_column name="TERM" pk="TERM" />
			</fk>
		</table>
		<view name="EXPANSIVELECTURES" >
			<comment><![CDATA[Lists all the lectures which have more workload than hours given by the curriculum]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT SBJNO, SBJNAME, NUMSCHD, NUMCURR 
FROM DB2INST1.SUBJECT 
WHERE NUMSCHD > NUMCURR;]]></view_script>
		</view>
		<view name="EXPORTEDSUBJECTS" >
			<comment><![CDATA[Listing subjects taught by lecturers with different departments]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT L.LECDEPT AS department, COUNT(*) AS export_count
FROM DB2INST1.LECTURER as L
JOIN DB2INST1.COURSEOFFERING as C on L.LECNO = C.LECNO 
JOIN DB2INST1.SUBJECT as S on C.SBJNO = S.SBJNO
WHERE L.LECDEPT != S.SRVCLIENT
GROUP BY L.LECDEPT
ORDER BY L.LECDEPT;]]></view_script>
		</view>
		<view name="IMPORTLECTURERS" >
			<comment><![CDATA[Listing lecturers teaching a subject with different department]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT S.SRVCLIENT AS department, COUNT(*) AS import_count
FROM DB2INST1.SUBJECT as S
JOIN DB2INST1.COURSEOFFERING as C on C.SBJNO = S.SBJNO
JOIN DB2INST1.LECTURER as L on L.LECNO = C.LECNO
WHERE S.SRVCLIENT != L.LECDEPT
GROUP BY S.SRVCLIENT
ORDER BY S.SRVCLIENT;]]></view_script>
		</view>
		<view name="LECTURERSWITHLOAD" >
			<comment><![CDATA[Lists lecturers with 2 or 3 courses per term]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT LECNO, TERM, COUNT(*) AS offerings 
FROM DB2INST1.COURSEOFFERING 
GROUP BY LECNO, TERM
HAVING COUNT(*) IN (2,3);]]></view_script>
		</view>
		<view name="PROFESSORSWITHREDUCTION" >
			<comment><![CDATA[Lists professors with additional workload (positive or negative)]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT DISTINCT L.LECNO 
FROM DB2INST1.LECTURER AS L 
JOIN DB2INST1.WORKLOADREDUCTION AS R ON R.LECNO = L.LECNO 
WHERE L.ISPROF = TRUE;]]></view_script>
		</view>
		<view name="PROFESSORWORKLOAD" >
			<comment><![CDATA[Shows the workload of each professor]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT LECNO, TERM, SUM(CNTLEC) AS total_lec_hrs 
FROM DB2INST1.COURSEOFFERING 
GROUP BY LECNO, TERM;]]></view_script>
		</view>
		<view name="STAFFMEMBERS" >
			<comment><![CDATA[Differentiates between professors and contract teachers]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT ISPROF, COUNT(*) AS cnt 
FROM DB2INST1.LECTURER 
GROUP BY ISPROF;]]></view_script>
		</view>
		<view name="TEACHINGPROFESSORS" >
			<comment><![CDATA[Lists all professors who are currently teaching]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT DISTINCT L.LECNO 
FROM DB2INST1.LECTURER AS L 
JOIN DB2INST1.COURSEOFFERING AS C ON C.LECNO = L.LECNO 
WHERE L.ISPROF = TRUE 
AND NOT EXISTS (
    SELECT 1
    FROM DB2INST1.WORKLOADREDUCTION AS R
    WHERE R.LECNO = L.LECNO
);]]></view_script>
		</view>
		<view name="TERMLIST" >
			<comment><![CDATA[Counts and lists all the terms stored in the database]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT COUNT (DISTINCT term) AS term_count
FROM COURSEOFFERING G;]]></view_script>
		</view>
		<view name="WORKLOADBALANCE" >
			<comment><![CDATA[Shows the workload through out the terms including the reductions]]></comment>
			<view_script><![CDATA[CREATE VIEW ${nameWithSchemaName} AS 
SELECT C.LECNO, C.TERM, SUM(C.CNTLEC) AS teach_hours, COALESCE(SUM(R.REDUCTION), 0) AS reduction_hours,  SUM(C.CNTLEC) + COALESCE(SUM(R.REDUCTION), 0) AS total_workload 
FROM DB2INST1.COURSEOFFERING AS C 
LEFT JOIN DB2INST1.WORKLOADREDUCTION AS R ON C.LECNO = R.LEC_NO 
AND C.TERM  = R.TERM 
GROUP BY C.LECNO, C.TERM 
ORDER BY C.LECNO, C.TERM;]]></view_script>
		</view>
	</schema>
	<layout name="Default Diagram" id="9ee97bac-d859-45aa-a907-f9dd991dcd41" confirmed="y" show_relation="columns" >
		<entity schema="DB2INST1" name="WORKLOADREDUCTION" color="C1D8EE" x="660" y="60" />
		<entity schema="DB2INST1" name="COURSEOFFERING" color="C1D8EE" x="340" y="380" />
		<entity schema="DB2INST1" name="LECTURER" color="C1D8EE" x="340" y="60" />
		<entity schema="DB2INST1" name="SEMESTER" color="C1D8EE" x="660" y="380" />
		<entity schema="DB2INST1" name="SUBJECT" color="C1D8EE" x="60" y="380" />
		<entity schema="DB2INST1" name="TERMLIST" color="3986C1" x="940" y="60" />
		<entity schema="DB2INST1" name="STAFFMEMBERS" color="3986C1" x="940" y="140" />
		<entity schema="DB2INST1" name="EXPANSIVELECTURES" color="3986C1" x="940" y="300" />
		<entity schema="DB2INST1" name="TEACHINGPROFESSORS" color="3986C1" x="940" y="380" />
		<entity schema="DB2INST1" name="LECTURERSWITHLOAD" color="3986C1" x="940" y="220" />
		<entity schema="DB2INST1" name="PROFESSORWORKLOAD" color="3986C1" x="940" y="460" />
		<entity schema="DB2INST1" name="PROFESSORSWITHREDUCTION" color="3986C1" x="1160" y="380" />
		<entity schema="DB2INST1" name="WORKLOADBALANCE" color="3986C1" x="940" y="540" />
		<entity schema="DB2INST1" name="IMPORTLECTURERS" color="3986C1" x="940" y="620" />
		<entity schema="DB2INST1" name="EXPORTEDSUBJECTS" color="3986C1" x="940" y="700" />
	</layout>
</project>